<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>PHP Manual: Sets user-level session storage functions</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td style="font-size: smaller;" width="15%">
<style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="index.html">PHP Manual</a></li>
  <li class="header up"><a href="funcref.html">Function Reference</a></li>
  <li class="header up"><a href="refs.basic.session.html">Session Extensions</a></li>
  <li class="header up"><a href="book.session.html">Sessions</a></li>
  <li class="header up"><a href="ref.session.html">Session Functions</a></li>
  <li><a href="function.session-abort.html">session_abort</a></li>
  <li><a href="function.session-cache-expire.html">session_cache_expire</a></li>
  <li><a href="function.session-cache-limiter.html">session_cache_limiter</a></li>
  <li><a href="function.session-commit.html">session_commit</a></li>
  <li><a href="function.session-create-id.html">session_create_id</a></li>
  <li><a href="function.session-decode.html">session_decode</a></li>
  <li><a href="function.session-destroy.html">session_destroy</a></li>
  <li><a href="function.session-encode.html">session_encode</a></li>
  <li><a href="function.session-gc.html">session_gc</a></li>
  <li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a></li>
  <li><a href="function.session-id.html">session_id</a></li>
  <li><a href="function.session-is-registered.html">session_is_registered</a></li>
  <li><a href="function.session-module-name.html">session_module_name</a></li>
  <li><a href="function.session-name.html">session_name</a></li>
  <li><a href="function.session-regenerate-id.html">session_regenerate_id</a></li>
  <li><a href="function.session-register-shutdown.html">session_register_shutdown</a></li>
  <li><a href="function.session-register.html">session_register</a></li>
  <li><a href="function.session-reset.html">session_reset</a></li>
  <li><a href="function.session-save-path.html">session_save_path</a></li>
  <li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a></li>
  <li class="active"><a href="function.session-set-save-handler.html">session_set_save_handler</a></li>
  <li><a href="function.session-start.html">session_start</a></li>
  <li><a href="function.session-status.html">session_status</a></li>
  <li><a href="function.session-unregister.html">session_unregister</a></li>
  <li><a href="function.session-unset.html">session_unset</a></li>
  <li><a href="function.session-write-close.html">session_write_close</a></li>
 </ul>

        </td>
        <td width="85%">
            <div style="text-align: center;">
                <div class="prev" style="text-align: left; float: left;"><a href="function.session-set-cookie-params.html">session_set_cookie_params</a></div>
                <div class="next" style="text-align: right; float: right;"><a href="function.session-start.html">session_start</a></div>
                <div class="up"><a href="ref.session.html">Session Functions</a></div>
                <div class="home"><a href="index.html">PHP Manual</a></div>
            </div><hr/>
<div id="function.session-set-save-handler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">session_set_save_handler</h1>
  <p class="refpurpose">Sets user-level session storage functions</p>
 </div>
 <div class="refsect1 description" id="refsect1-function.session-set-save-handler-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname">session_set_save_handler</span>
    ( <span class="methodparam"><span class="type">callable</span> <code class="parameter">$open</code></span>
   , <span class="methodparam"><span class="type">callable</span> <code class="parameter">$close</code></span>
   , <span class="methodparam"><span class="type">callable</span> <code class="parameter">$read</code></span>
   , <span class="methodparam"><span class="type">callable</span> <code class="parameter">$write</code></span>
   , <span class="methodparam"><span class="type">callable</span> <code class="parameter">$destroy</code></span>
   , <span class="methodparam"><span class="type">callable</span> <code class="parameter">$gc</code></span>
   [, <span class="methodparam"><span class="type">callable</span> <code class="parameter">$create_sid</code></span>
   [, <span class="methodparam"><span class="type">callable</span> <code class="parameter">$validate_sid</code></span>
   [, <span class="methodparam"><span class="type">callable</span> <code class="parameter">$update_timestamp</code></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   Since PHP 5.4 it is possible to register the following prototype:
  </p>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname">session_set_save_handler</span>
    ( <span class="methodparam"><span class="type">SessionHandlerInterface</span> <code class="parameter">$sessionhandler</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$register_shutdown</code><span class="initializer"> = true</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function">session_set_save_handler</span> sets the user-level
   session storage functions which are used for storing and
   retrieving data associated with a session.  This is most useful
   when a storage method other than those supplied by PHP sessions
   is preferred, e.g. storing the session data in a local database.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.session-set-save-handler-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   This function has two prototypes.
   <dl>

    
     <dt>
<code class="parameter">sessionhandler</code></dt>

     <dd>

      <p class="para">
       An instance of a class implementing
       <span class="interfacename">SessionHandlerInterface</span>, such as
       <span class="classname">SessionHandler</span>, to register as the session
       handler. Since PHP 5.4 only.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">register_shutdown</code></dt>

     <dd>

      <p class="para">
       Register <span class="function">session_write_close</span> as a
       <span class="function">register_shutdown_function</span> function.
      </p>
     </dd>

    
   </dl>


   or

   <dl>

    
     <dt>
<code class="parameter">open(string $savePath, string $sessionName)</code></dt>

     <dd>

      <p class="para">
       The open callback works like a constructor in classes and is
       executed when the session is being opened.  It is the first callback
       function executed when the session is started automatically or
       manually with <span class="function">session_start</span>.
       Return value is <strong><code>TRUE</code></strong> for success, <strong><code>FALSE</code></strong> for failure.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">close()</code></dt>

     <dd>

      <p class="para">
       The close callback works like a destructor in classes and is
       executed after the session write callback has been called. It is also invoked when
       <span class="function">session_write_close</span> is called.
       Return value should be <strong><code>TRUE</code></strong> for success, <strong><code>FALSE</code></strong> for failure.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">read(string $sessionId)</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">read</code> callback must always return a session encoded (serialized)
       string, or an empty string if there is no data to read.
      </p>
      <p class="para">
       This callback is called internally by PHP when the session starts or
       when <span class="function">session_start</span> is called.  Before this callback is invoked
       PHP will invoke the <code class="parameter">open</code> callback.
      </p>
      <p class="para">
       The value this callback returns must be in exactly the same serialized format that was originally
       passed for storage to the <code class="parameter">write</code> callback.  The value returned will be
       unserialized automatically by PHP and used to populate the <var class="varname">$_SESSION</var> superglobal.
       While the data looks similar to <span class="function">serialize</span> please note it is a different format
       which is speficied in the <a href="session.configuration.html#ini.session.serialize-handler" class="link">session.serialize_handler</a> ini setting.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">write(string $sessionId, string $data)</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">write</code> callback is called when the session needs to be saved and closed. This
       callback receives the current session ID a serialized version the <var class="varname">$_SESSION</var> superglobal.  The serialization
       method used internally by PHP is specified in the <a href="session.configuration.html#ini.session.serialize-handler" class="link">session.serialize_handler</a> ini setting.
      </p>
      <p class="para">
       The serialized session data passed to this callback should be stored against the passed session ID. When retrieving
       this data, the <code class="parameter">read</code> callback must return the exact value that was originally passed to
       the <code class="parameter">write</code> callback.
      </p>
      <p class="para">
       This callback is invoked when PHP shuts down or explicitly when <span class="function">session_write_close</span>
       is called.  Note that after executing this function PHP will internally execute the <code class="parameter">close</code> callback.
       <blockquote class="note"><p><strong class="note">Note</strong>: 
        <p class="para">
         The &quot;write&quot; handler is not executed until after the output stream is
         closed.  Thus, output from debugging statements in the &quot;write&quot;
         handler will never be seen in the browser.  If debugging output is
         necessary, it is suggested that the debug output be written to a
         file instead.
        </p>
       </p></blockquote>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">destroy($sessionId)</code></dt>

     <dd>

      <p class="para">
       This callback is executed when a session is destroyed with <span class="function">session_destroy</span> or with
       <span class="function">session_regenerate_id</span> with the destroy parameter set to <strong><code>TRUE</code></strong>.
       Return value should be <strong><code>TRUE</code></strong> for success, <strong><code>FALSE</code></strong> for failure.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">gc($lifetime)</code></dt>

     <dd>

      <p class="para">
       The garbage collector callback is invoked internally by PHP periodically in order to
       purge old session data.  The frequency is controlled by
       <a href="session.configuration.html#ini.session.gc-probability" class="link">session.gc_probability</a> and <a href="session.configuration.html#ini.session.gc-divisor" class="link">session.gc_divisor</a>.
       The value of lifetime which is passed to this callback can be set in <a href="session.configuration.html#ini.session.gc-maxlifetime" class="link">session.gc_maxlifetime</a>.
       Return value should be <strong><code>TRUE</code></strong> for success, <strong><code>FALSE</code></strong> for failure.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">create_sid()</code></dt>

     <dd>

      <p class="para">
       This callback is executed when a new session ID is required. No
       parameters are provided, and the return value should be a string that
       is a valid session ID for your handler.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.session-set-save-handler-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.session-set-save-handler-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-5382">
    <p><strong>Example #1 
     Custom session handler: see full code in <span class="classname">SessionHandlerInterface</span> synopsis.
    </strong></p>
    <div class="example-contents"><p>
     The following code is for PHP version 5.4.0 and above.  We just show the invocation here, the full example can be
     seen in the <span class="classname">SessionHandlerInterface</span> synopsis linked above.
    </p></div>
    <div class="example-contents"><p>
     Note we use the OOP prototype with <span class="function">session_set_save_handler</span> and
     register the shutdown function using the function&#039;s parameter flag.  This is generally
     advised when registering objects as session save handlers.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">MySessionHandler&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">SessionHandlerInterface<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;implement&nbsp;interfaces&nbsp;here<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #0000BB">$handler&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MySessionHandler</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">session_set_save_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;proceed&nbsp;to&nbsp;set&nbsp;and&nbsp;retrieve&nbsp;values&nbsp;by&nbsp;key&nbsp;from&nbsp;$_SESSION</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-5383">
    <p><strong>Example #2 Custom session save handler using objects</strong></p>
    <div class="example-contents"><p>
     The following code is for PHP versions less than 5.4.0.
    </p></div>
    <div class="example-contents"><p>
     The following example provides file based session storage similar to the
     PHP sessions default save handler <code class="parameter">files</code>.  This
     example could easily be extended to cover database storage using your
     favorite PHP supported database engine.
    </p></div>
    <div class="example-contents"><p>
     Note we additionally register the shutdown function <span class="function">session_write_close</span>
     using <span class="function">register_shutdown_function</span> under PHP less than 5.4.0.
     This is generally advised when registering objects as session save handlers under PHP less
     than 5.4.0.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">FileSessionHandler<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$savePath</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #0000BB">$savePath</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sessionName</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$savePath</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_dir</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mkdir</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0777</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">close</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(string)@</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #DD0000">/sess_</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">write</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #DD0000">/sess_</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">destroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #DD0000">/sess_</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">gc</span><span style="color: #007700">(</span><span style="color: #0000BB">$maxlifetime</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">glob</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">savePath</span><span style="color: #DD0000">/sess_*"</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">filemtime</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;+&nbsp;</span><span style="color: #0000BB">$maxlifetime&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$handler&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">FileSessionHandler</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">session_set_save_handler</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'open'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'close'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'read'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'write'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'destroy'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'gc'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;);<br /><br /></span><span style="color: #FF8000">//&nbsp;the&nbsp;following&nbsp;prevents&nbsp;unexpected&nbsp;effects&nbsp;when&nbsp;using&nbsp;objects&nbsp;as&nbsp;save&nbsp;handlers<br /></span><span style="color: #0000BB">register_shutdown_function</span><span style="color: #007700">(</span><span style="color: #DD0000">'session_write_close'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;proceed&nbsp;to&nbsp;set&nbsp;and&nbsp;retrieve&nbsp;values&nbsp;by&nbsp;key&nbsp;from&nbsp;$_SESSION</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.session-set-save-handler-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    When using objects as session save handlers, it is important to register the
    shutdown function with PHP to avoid unexpected side-effects from the way
    PHP internally destroys objects on shutdown and may prevent the
    <code class="parameter">write</code> and <code class="parameter">close</code> from being called.
    Typically you should register <code class="parameter">&#039;session_write_close&#039;</code> using the
    <span class="function">register_shutdown_function</span> function.
   </p>
   <p class="para">
    As of PHP 5.4.0 you can use <span class="function">session_register_shutdown</span> or
    simply use the &#039;register shutdown&#039; flag when invoking
    <span class="function">session_set_save_handler</span> using the OOP method and passing an
    instance that implements <span class="classname">SessionHandlerInterface</span>.
   </p>
  </div>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    As of PHP 5.0.5 the <code class="parameter">write</code> and
    <code class="parameter">close</code> handlers are called after object
    destruction and therefore cannot use objects or throw exceptions.
    Exceptions are not able to be caught since will not be caught nor will
    any exception trace be displayed and the execution will just cease unexpectedly.
    The object destructors can however use sessions.
   </p>
   <p class="para">
    It is possible to call <span class="function">session_write_close</span> from the
    destructor to solve this chicken and egg problem but the most reliable way is
    to register the shutdown function as described above.
   </p>
  </div>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    Current working directory is changed with some SAPIs if session is
    closed in the script termination. It is possible to close the session
    earlier with <span class="function">session_write_close</span>.
   </p>
  </div>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.session-set-save-handler-changelog">
  <h3 class="title">Changelog</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Version</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>5.5.1</td>
      <td>
       Added the optional <code class="parameter">create_sid</code> parameter.
      </td>
     </tr>

     <tr>
      <td>5.4.0</td>
      <td>
       Added <span class="interfacename">SessionHandlerInterface</span> for implementing session handlers and
       <span class="classname">SessionHandler</span> to expose internal PHP session handlers.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.session-set-save-handler-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     The <a href="session.configuration.html#ini.session.save-handler" class="link">session.save_handler</a>
     configuration directive
    </li>
    <li class="member">
     The <a href="session.configuration.html#ini.session.serialize-handler" class="link">session.serialize_handler</a>
     configuration directive.
    </li>
    <li class="member">The <span class="function">register_shutdown_function</span></li>
    <li class="member">The <span class="function">session_register_shutdown</span> for PHP 5.4.0+</li>
    <li class="member">
     Refer to <a href="https://github.com/php/php-src/blob/master/ext/session/tests/save_handler.inc" class="link external">&raquo;&nbsp;save_handler.inc</a>
     for a full procedural reference implementation
    </li>
   </ul>
  </p>
 </div>


</div>
        </td>
    </tr>
</table>
</body>
</html>
