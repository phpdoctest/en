<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>PHP Manual: Architecture</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td style="font-size: smaller;" width="15%">
<style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="index.html">PHP Manual</a></li>
  <li class="header up"><a href="funcref.html">Function Reference</a></li>
  <li class="header up"><a href="refs.database.html">Database Extensions</a></li>
  <li class="header up"><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>
  <li class="header up"><a href="set.mysqlinfo.html">MySQL</a></li>
  <li class="header up"><a href="book.mysqlnd-ms.html">mysqlnd_ms</a></li>
  <li class="header up"><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
  <li class="active"><a href="mysqlnd-ms.architecture.html">Architecture</a></li>
  <li><a href="mysqlnd-ms.pooling.html">Connection pooling and switching</a></li>
  <li><a href="mysqlnd-ms.transaction.html">Local transaction handling</a></li>
  <li><a href="mysqlnd-ms.errorhandling.html">Error handling</a></li>
  <li><a href="mysqlnd-ms.transient_errors.html">Transient errors</a></li>
  <li><a href="mysqlnd-ms.failover.html">Failover</a></li>
  <li><a href="mysqlnd-ms.loadbalancing.html">Load balancing</a></li>
  <li><a href="mysqlnd-ms.rwsplit.html">Read-write splitting</a></li>
  <li><a href="mysqlnd-ms.filter.html">Filter</a></li>
  <li><a href="mysqlnd-ms.qos-consistency.html">Service level and consistency</a></li>
  <li><a href="mysqlnd-ms.gtid.html">Global transaction IDs</a></li>
  <li><a href="mysqlnd-ms.concept_cache.html">Cache integration</a></li>
  <li><a href="mysqlnd-ms.supportedclusters.html">Supported clusters</a></li>
  <li><a href="mysqlnd-ms.concept_xa_trx.html">XA/Distributed transactions</a></li>
 </ul>

        </td>
        <td width="85%">
            <div style="text-align: center;">
                <div class="prev" style="text-align: left; float: left;"><a href="mysqlnd-ms.concepts.html">Concepts</a></div>
                <div class="next" style="text-align: right; float: right;"><a href="mysqlnd-ms.pooling.html">Connection pooling and switching</a></div>
                <div class="up"><a href="mysqlnd-ms.concepts.html">Concepts</a></div>
                <div class="home"><a href="index.html">PHP Manual</a></div>
            </div><hr/>
<div id="mysqlnd-ms.architecture" class="section">
  <h2 class="title">Architecture</h2>
  <p class="para">
   The mysqlnd replication and load balancing plugin is
   implemented as a PHP extension.
   It is written in C and operates under the hood of PHP. During the
   startup of the PHP interpreter, in the module init phase of the
   PHP engine, it gets registered as a
   <a href="book.mysqlnd.html" class="link">mysqlnd</a> plugin to replace selected
   mysqlnd C methods.
  </p>
  <p class="para">
   At PHP runtime, it inspects queries sent from
   mysqlnd (PHP) to the MySQL server. If a query is recognized as read-only,
   it will be sent to one of the configured slave servers. Statements are
   considered read-only if they either start with <em>SELECT</em>,
   the SQL hint <em>/*ms=slave*/</em> or a slave had been chosen for
   running the previous query, and the query started with the SQL hint
   <em>/*ms=last_used*/</em>. In all other cases, the query will
   be sent to the MySQL replication master server.
  </p>
  <p class="para">
   For better portability, applications should use the
   <strong><code>MYSQLND_MS_MASTER_SWITCH</code></strong>,
   <strong><code>MYSQLND_MS_SLAVE_SWITCH</code></strong>, and
   <strong><code>MYSQLND_MS_LAST_USED_SWITCH</code></strong>
   <a href="mysqlnd-ms.constants.html" class="link">predefined mysqlnd_ms constants</a>,
   instead of their literal values, such as <em>/*ms=slave*/</em>.
  </p>
  <p class="para">
   The plugin handles the opening and closing of database connections
   to both master and slave servers. From an application
   point of view, there continues to be only one connection handle. However,
   internally, this one public connection handle represents a pool of
   network connections that are managed by the plugin. The plugin proxies queries
   to the master server, and to the slaves using multiple connections.
  </p>
  <p class="para">
    Database connections have a state consisting of, for example, transaction
    status, transaction settings, character set settings, and temporary tables.
    The plugin will try to maintain the same state among all internal
    connections, whenever this can be done in an automatic and transparent way.
    In cases where it is not easily possible to maintain state among all
    connections, such as when using <em>BEGIN TRANSACTION</em>, the
    plugin leaves it to the user to handle.
  </p>

 </div>
        </td>
    </tr>
</table>
</body>
</html>
