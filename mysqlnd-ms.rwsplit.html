<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>PHP Manual: Read-write splitting</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td style="font-size: smaller;" width="15%">
<style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="index.html">PHP Manual</a></li>
  <li class="header up"><a href="funcref.html">Function Reference</a></li>
  <li class="header up"><a href="refs.database.html">Database Extensions</a></li>
  <li class="header up"><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>
  <li class="header up"><a href="set.mysqlinfo.html">MySQL</a></li>
  <li class="header up"><a href="book.mysqlnd-ms.html">mysqlnd_ms</a></li>
  <li class="header up"><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
  <li><a href="mysqlnd-ms.architecture.html">Architecture</a></li>
  <li><a href="mysqlnd-ms.pooling.html">Connection pooling and switching</a></li>
  <li><a href="mysqlnd-ms.transaction.html">Local transaction handling</a></li>
  <li><a href="mysqlnd-ms.errorhandling.html">Error handling</a></li>
  <li><a href="mysqlnd-ms.transient_errors.html">Transient errors</a></li>
  <li><a href="mysqlnd-ms.failover.html">Failover</a></li>
  <li><a href="mysqlnd-ms.loadbalancing.html">Load balancing</a></li>
  <li class="active"><a href="mysqlnd-ms.rwsplit.html">Read-write splitting</a></li>
  <li><a href="mysqlnd-ms.filter.html">Filter</a></li>
  <li><a href="mysqlnd-ms.qos-consistency.html">Service level and consistency</a></li>
  <li><a href="mysqlnd-ms.gtid.html">Global transaction IDs</a></li>
  <li><a href="mysqlnd-ms.concept_cache.html">Cache integration</a></li>
  <li><a href="mysqlnd-ms.supportedclusters.html">Supported clusters</a></li>
  <li><a href="mysqlnd-ms.concept_xa_trx.html">XA/Distributed transactions</a></li>
 </ul>

        </td>
        <td width="85%">
            <div style="text-align: center;">
                <div class="prev" style="text-align: left; float: left;"><a href="mysqlnd-ms.loadbalancing.html">Load balancing</a></div>
                <div class="next" style="text-align: right; float: right;"><a href="mysqlnd-ms.filter.html">Filter</a></div>
                <div class="up"><a href="mysqlnd-ms.concepts.html">Concepts</a></div>
                <div class="home"><a href="index.html">PHP Manual</a></div>
            </div><hr/>
<div id="mysqlnd-ms.rwsplit" class="section">
  <h2 class="title">Read-write splitting</h2>
  <p class="para">
   The plugin executes read-only statements on the configured MySQL slaves, and
   all other queries on the MySQL master. Statements are
   considered read-only if they either start with <em>SELECT</em>,
   the SQL hint <em>/*ms=slave*/</em>, or if a slave had been chosen for
   running the previous query and the query starts with the SQL hint
   <em>/*ms=last_used*/</em>. In all other cases, the query will
   be sent to the MySQL replication master server. It is recommended to
   use the constants <strong><code>MYSQLND_MS_SLAVE_SWITCH</code></strong>,
   <strong><code>MYSQLND_MS_MASTER_SWITCH</code></strong> and <strong><code>MYSQLND_MS_LAST_USED_SWITCH</code></strong>
   instead of <em>/*ms=slave*/</em>. See also the
   <a href="mysqlnd-ms.constants.html" class="link">list of mysqlnd_ms constants</a>.
  </p>
  <p class="para">
   SQL hints are a special kind of standard compliant SQL comments. The plugin
   does check every statement for certain SQL hints. The SQL hints are described
   within the <a href="mysqlnd-ms.constants.html" class="link">mysqlnd_ms constants</a>
   documentation, constants that are exported by the extension. Other systems
   involved with the statement processing, such as the MySQL server, SQL firewalls,
   and SQL proxies, are unaffected by the SQL hints, because those systems are
   designed to ignore SQL comments.
  </p>
  <p class="para">
   The built-in read-write splitter can be replaced by a user-defined filter, see also the
   <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.filter-user" class="link">user filter</a>
   documentation.
  </p>
  <p class="para">
   A user-defined read-write splitter can request the built-in logic to
   send a statement to a specific location, by invoking
   <span class="function">mysqlnd_ms_is_select</span>.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    The built-in read-write splitter is not aware of multi-statements.
    Multi-statements are seen as one statement. The splitter will check the
    beginning of the statement to decide where to run the statement. If, for example,
    a multi-statement begins with
    <em>SELECT 1 FROM DUAL; INSERT INTO test(id) VALUES (1); ...</em>
    the plugin will run it on a slave although the statement is not read-only.
   </p>
  </p></blockquote>
 </div>
        </td>
    </tr>
</table>
</body>
</html>
